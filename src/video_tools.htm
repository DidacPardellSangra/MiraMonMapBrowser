<html>
<!--
    This file is part of MiraMon Map Browser.

    MiraMon Map Browser is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Foobar is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with MiraMon Map Browser.  If not, see "http://www.gnu.org/licenses/".

    Copyright 2001, 2016 Xavier Pons

    Aquest codi JavaScript ha estat realitzat per Joan Masó Pau 
    (joan maso at uab cat) i Nuria Julià (n julia at creaf uab cat)
    dins del grup de MiraMon. MiraMon és un projecte del Centre
    de recerca i aplicacions forestals (CREAF) que elabora programari de 
    Sistema d'Informació Geogràfica i de Teledetecció per a la 
    visualització, consulta, edició i anàlisi de mapes ràsters i 
    vectorials. Elabora programari d'escriptori i també servidors i clients 
    per Internet. No tots aquests productes són gratuïts o de codi obert. 
    En particular, el Navegador de Mapes del MiraMon (client per Internet) 
    es distribueix sota els termes de la llicència "GNU General Public 
    License". Es pot actualitzar des de www.creaf.uab.cat/miramon/mmn
-->

<head>
<title>Video</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<script LANGUAGE="JavaScript">
<!--   Inici de JavaScript  

var DatesVideo=[];
function CreaDataVideoDeCapes(i_capa, i_data, data, animable)
{
var d=new Date(data.year ? data.year : 1970, data.month ? data.month-1 : 0, data.day ? data.day : 1, data.hour ? data.hour : 0, data.minute ? data.minute : 0, data.second ? data.second : 0);

	this.i_capa=i_capa;
	this.i_data=i_data;
	this.milisegons=d.getTime();
	this.animable=animable;
}

function OrdenacioCapesVideoData(x,y) 
{
	//Ascendent per data 
	return (x.milisegons - y.milisegons);
}

function TancaCaixaVideo()
{
    parent.opener.focus();
    parent.opener.VideoWindow=null;
    parent.close();	
    return false;  //per no efectuar l'acció de submit del formulari
}

function DibuixaOpcionsVideo()
{
var cdns=[];
var i_capa_primer_video;

    //Determinar el primer video actiu.
	with (parent.opener)
	{
	    //Dibuixar el desplegable de videos.
		this.parent.VideoAnimacio.document.open();		
		cdns.push("<html><BODY BGCOLOR=\"",ParamCtrl.ColorFonsPlana,
				  "\" TOPMARGIN=\"0\" LEFTMARGIN=\"0\" MARGINWIDTH=\"0\" MARGINHEIGHT=\"0\" TEXT=\"#000000\">",
				  "<FORM NAME=\"animacions\" METHOD=\"GET\" onSubmit=\"return parent.VideoTools.CanviaAnimacio(document.animacions.tria.value);\">",
				  "<div align=\"right\"><font face=\"Verdana, Arial, Helvetica, sans-serif\" size=2>",
				  DonaCadenaLang({"cat":"Animacions", "spa":"Animaciones", "eng":"Animations", "fre":"Animations"}),
				  ": <select name=\"tria\" onChange=\"parent.VideoTools.CanviaAnimacio(document.animacions.tria.value);\">");
							
		for (i_capa_primer_video=0; i_capa_primer_video<ParamCtrl.capa.length; i_capa_primer_video++)
		{
		 	if (ParamCtrl.capa[i_capa_primer_video].NomVideo!=null)
			    break;
		}
		var i_video=0;
		for (var i_capa_video_actiu=i_capa_primer_video; i_capa_video_actiu<ParamCtrl.capa.length; i_capa_video_actiu++)
		{
		    if (ParamCtrl.capa[i_capa_video_actiu].NomVideo!=null)
		    {
				cdns.push("<OPTION VALUE=\"",ParamCtrl.capa[i_capa_video_actiu].NomVideo,"\"",((i_video==0) ? " SELECTED" : ""),">" ,
						DonaCadena(ParamCtrl.capa[i_capa_video_actiu].DescVideo),"</OPTION>");
				i_video++;
				//Salto la resta.
				for (var i_capa_video_actiu2=i_capa_video_actiu+1;	true; i_capa_video_actiu2++)
				{
				    if (i_capa_video_actiu2==ParamCtrl.capa.length ||
						(ParamCtrl.capa[i_capa_video_actiu2].NomVideo!=null && ParamCtrl.capa[i_capa_video_actiu2].NomVideo!=ParamCtrl.capa[i_capa_video_actiu].NomVideo))
			    	{
						i_capa_video_actiu=i_capa_video_actiu2-1;
						break;
				    }
				}
		    }
		}
		cdns.push("</select></div></form></html>");
		this.parent.VideoAnimacio.document.write(cdns.join(""));
		this.parent.VideoAnimacio.document.close();
		
	    //Dibuixar la data i la barra de progrés del video.
		this.parent.VideoEvolucio.document.open();		
		cdns.length=0;
		cdns.push("<html><BODY BGCOLOR=\"",ParamCtrl.ColorFonsPlana,"\" TOPMARGIN=\"0\" LEFTMARGIN=\"0\" MARGINWIDTH=\"0\" MARGINHEIGHT=\"0\" TEXT=\"#000000\">",
				  "<CENTER><FORM NAME=\"flux\"><font face=\"Verdana, Arial, Helvetica, sans-serif\" size=2>",
				  DonaCadenaLang({"cat":"Data", "spa":"Fecha", "eng":"Date","fre":"Date"}),": <input name=\"data\" size=\"21\" value=\"\"><br><img src=\"evol_mrg.gif\" border=\"0\">");
		var n=parseInt((ParamInternCtrl.vista.ncol-2)/10,10);		
		for (i=0; i<n; i++)
			cdns.push("<img src=\"evol_bl.gif\" border=\"0\" name=\"evol",i,"\">");		
		cdns.push("<img src=\"evol_mrg.gif\" border=\"0\"></form></CENTER></html>");			
		this.parent.VideoEvolucio.document.write(cdns.join(""));	
		this.parent.VideoEvolucio.document.close();
		
		//Creo la pantalla on es projecte el video.
		this.parent.VideoPantalla.document.open();		
		this.parent.VideoPantalla.document.writeln("<html>"+
							"<BODY BGCOLOR=\"" + ParamCtrl.ColorFonsPlana + "\" TOPMARGIN=\"0\" LEFTMARGIN=\"0\" MARGINWIDTH=\"0\" MARGINHEIGHT=\"0\">"+
							"<CENTER><IMG SRC=\"1gris.gif\" NAME=\"pantalla\" width=\""+ ParamInternCtrl.vista.ncol +"\" height=\""+ ParamInternCtrl.vista.nfil +"\">"+
							"</CENTER>"+
							"</html>");
		this.parent.VideoPantalla.document.close();
		
	    //Si hi ha un video actiu, activar la seva preparació.
		this.CanviaAnimacio(this.parent.VideoAnimacio.document.animacions.tria.value);
	}
}

function CanviaEstatAnimable(boto, i_capa_video)
{
    if (boto.checked)
		DatesVideo[i_capa_video].animable=true;
	else
		DatesVideo[i_capa_video].animable=false;
}

function EsFotogramaDisponibleEstil(i_capa_video_actiu, estil)
{
	with (parent.opener)
	{
		if (ParamCtrl.capa[i_capa_video_actiu].estil && ParamCtrl.capa[i_capa_video_actiu].estil.length>1 && estil)
		{
	        for (var i_estil_video_actiu=0; i_estil_video_actiu<ParamCtrl.capa[i_capa_video_actiu].estil.length; i_estil_video_actiu++)
			{
		     	if (estil==ParamCtrl.capa[i_capa_video_actiu].estil[i_estil_video_actiu].nom)
					return true;
			}
			return false;
		}
	}
	return true;
}

var ICapaVideoMostrada=-1;
var NomVideoActiu;

function CanviaVideo(nom_video, estil)
{
var i_data_video;
var cdns=[];


	with (parent.opener)
	{
	    //Dibuixar rodet de fotogrames.
		this.parent.VideoRodet.document.open();		
		cdns.push("<html><BODY BGCOLOR=\"",ParamCtrl.ColorFonsPlana,
				"\" TOPMARGIN=\"0\" LEFTMARGIN=\"0\" MARGINWIDTH=\"0\" MARGINHEIGHT=\"0\" TEXT=\"#FFFFFF\" BACKGROUND=\"1film.gif\">",					
				"<FORM NAME=\"rodet\">",
				"<TABLE BORDER=\"0\" CELLSPACING=\"0\" CELLPADDING=\"0\">");		
		DatesVideo.length=0;
		for (var i_capa=0; i_capa<ParamCtrl.capa.length; i_capa++)
		{	
			if (ParamCtrl.capa[i_capa].NomVideo!=null &&
			    ParamCtrl.capa[i_capa].NomVideo==nom_video &&
				ParamCtrl.capa[i_capa].animable && ParamCtrl.capa[i_capa].animable==true &&
				EsFotogramaDisponibleEstil(i_capa, estil) && 
				ParamCtrl.capa[i_capa].data)
			{				
				for(var i_data=0; i_data<ParamCtrl.capa[i_capa].data.length; i_data++)
					DatesVideo[DatesVideo.length]=new CreaDataVideoDeCapes(i_capa, i_data, ParamCtrl.capa[i_capa].data[i_data], 
															(ParamCtrl.capa[i_capa].animable && ParamCtrl.capa[i_capa].animable==true) ? true : false);					
			}
		}
		DatesVideo.sort(OrdenacioCapesVideoData);

	    height_negatiu=85*ParamInternCtrl.vista.nfil/ParamInternCtrl.vista.ncol;
		for (i_data_video=0; i_data_video<DatesVideo.length; i_data_video++)
		{	
			cdns.push("<tr><td rowspan=\"4\" width=\"13\">&nbsp;</td><td colspan=3><font face=\"Verdana, Arial, Helvetica, sans-serif\" size=1><input ",
						((DatesVideo[i_data_video].animable) ? "checked" : ""), " name=\"foto",i_data_video,
						"\" type=\"checkbox\" onClick=\"parent.VideoTools.CanviaEstatAnimable(this, ", i_data_video ,");\"><small>",
						DonaDataCapaComATextBreu(DatesVideo[i_data_video].i_capa, DatesVideo[i_data_video].i_data),"</small></td></tr>",
						"<tr><td colspan=3><img name=\"marc_sup",i_data_video,"\" src=\"1negre.gif\" width=\"89\" height=\"2\"></td></tr>",
						"<td><img name=\"marc_dre",i_data_video,"\" src=\"1negre.gif\" width=\"2\" height=\"",height_negatiu,"\"></td>",
						"<td><img name=\"foto",i_data_video,"\" src=\"",
						DonaNomImatge(DatesVideo[i_data_video].i_capa, ParamInternCtrl.vista,estil, false, DatesVideo[i_data_video].i_data),
						"\" width=\"85\" height=\"",height_negatiu,"\" border=\"0\" onClick=\"parent.VideoTools.MostraFotogramaAillat(",
						i_data_video,",false)\"></td>","<td><img name=\"marc_esq",i_data_video,"\" src=\"1negre.gif\" width=\"2\" height=\"",
						height_negatiu,"\"></td></tr>","<tr><td colspan=3><img name=\"marc_inf",i_data_video,
						"\" src=\"1negre.gif\" width=\"89\" height=\"2\"></td></tr>");
		}
		cdns.push("</TABLE>&nbsp;</form></html>");
		this.parent.VideoRodet.document.writeln(cdns.join(""));				
		this.parent.VideoRodet.document.close();
	}
	NomVideoActiu=nom_video;
	
}//Fi de CanviaVideo()

function CanviaAnimacio(nom_video)
{
//Generar desplegable d'estils.
var estils=[];
var desc_estils=[];
var cdns=[];

	with (parent.opener)
    {
		//Determino la llista d'estils.
		for (var i_capa_video_actiu=0;i_capa_video_actiu<ParamCtrl.capa.length; i_capa_video_actiu++)
		{
    		if (ParamCtrl.capa[i_capa_video_actiu].NomVideo!=null && nom_video==ParamCtrl.capa[i_capa_video_actiu].NomVideo)
			{
				if (ParamCtrl.capa[i_capa_video_actiu].estil==null || ParamCtrl.capa[i_capa_video_actiu].estil.length==0 || 
					ParamCtrl.capa[i_capa_video_actiu].estil[0].nom==null || ParamCtrl.capa[i_capa_video_actiu].estil[0].nom=="")
				{
					for (i_estil=0; i_estil<estils.length; i_estil++)
					{
						if (estils[i_estil]=="")
							break;
					}
					if (i_estil==estils.length)
					{
						estils[estils.length]="";
						desc_estils[desc_estils.length]="";
					}
				}
				else
				{
					for (i_estil_video_actiu=0; i_estil_video_actiu<ParamCtrl.capa[i_capa_video_actiu].estil.length; i_estil_video_actiu++)
					{				
						for (i_estil=0; i_estil<estils.length; i_estil++)
						{
							if (estils[i_estil]==ParamCtrl.capa[i_capa_video_actiu].estil[i_estil_video_actiu].nom)
								break;
						}
						if (i_estil==estils.length)
						{
							estils[estils.length]=ParamCtrl.capa[i_capa_video_actiu].estil[i_estil_video_actiu].nom;							
							desc_estils[desc_estils.length]=ParamCtrl.capa[i_capa_video_actiu].estil[i_estil_video_actiu].desc;
						}
					}
				}
			}
		}
		cdns.push("<html><BODY BGCOLOR=\"",ParamCtrl.ColorFonsPlana,"\" TOPMARGIN=\"0\" LEFTMARGIN=\"0\" MARGINWIDTH=\"0\" MARGINHEIGHT=\"0\" TEXT=\"#000000\">");
		if (estils.length==0 || estils[0]=="")
			;
		else if (estils.length==1 && estils[0]!="")
			cdns.push("<font face=\"Verdana, Arial, Helvetica, sans-serif\" size=2><b>",desc_estils[0],"</b></font>");
		else
		{
			cdns.push("<FORM NAME=\"estils\" METHOD=\"GET\" onSubmit=\"return ",
				"parent.VideoTools.CanviaVideo(parent.VideoAnimacio.document.animacions.tria.value, document.estils.tria.value);\">",
				"<font face=\"Verdana, Arial, Helvetica, sans-serif\" size=2>",
				"<select name=\"tria\" onChange=\"parent.VideoTools.CanviaVideo(parent.VideoAnimacio.document.animacions.tria.value, document.estils.tria.value);\">");				
			for (i_estil=0; i_estil<estils.length; i_estil++)
				cdns.push("<OPTION VALUE=\"",estils[i_estil],"\"",((i_estil==0) ? " SELECTED" : "") +">",DonaCadena(desc_estils[i_estil]),"</OPTION>");
			cdns.push("</select></form>");
		}
		cdns.push("</html>");
		this.parent.VideoEstil.document.write(cdns.join(""));
		this.parent.VideoEstil.document.close();
    }
    CanviaVideo(nom_video, ((estils[0]=="") ? null : estils[0]));
}

function MostraFotogramaAillat(i_capa_video, actualitza_scroll)
{
   	if (timeoutID!=null)
	{
        clearTimeout(timeoutID);
	    timeoutID=null;
	}
    MostraFotograma(i_capa_video, actualitza_scroll);
}

function MostraFotograma(i_capa_video, actualitza_scroll)
{
var j;

	ICapaVideoMostrada=i_capa_video;
	parent.VideoEvolucio.document.flux.data.value=parent.opener.DonaDataComAText(DatesVideo[i_capa_video].i_capa, DatesVideo[i_capa_video].i_data);
	//Apago la barra de progrés de videos.
	var n=parseInt((parent.opener.ParamInternCtrl.vista.ncol-2)/10,10);
	//Encenc l'element de la barra que toca.
    if (parent.VideoBarra.document.botons.TipusTemps[0].checked)
	{
	    with (parent.opener)
		{
			this.i=parseInt(((DatesVideo[i_capa_video].milisegons-DatesVideo[0].milisegons)/(DatesVideo[DatesVideo.length-1].milisegons-DatesVideo[0].milisegons))*(n-1),10);
		}
	}
	else
	{
	    i=parseInt((n-1)*((i_capa_video)/(DatesVideo.length-1)),10);
	}
	for (j=0; j<i; j++)
	{
		eval("parent.VideoEvolucio.document.evol"+j+".src=\"evol_blau.gif\"");
	}
	if (j==n-1)
	{
	    eval("parent.VideoEvolucio.document.evol"+j+".src=\"evol_pnt_blau.gif\"");
	}
	else
	{
	    eval("parent.VideoEvolucio.document.evol"+j+".src=\"evol_pnt.gif\"");
	    for (j++; j<n; j++)
	    {
		    eval("parent.VideoEvolucio.document.evol"+j+".src=\"evol_bl.gif\"");
	    }
	}

	//Canvio la imatge per la que toca.
	eval("parent.VideoPantalla.document.pantalla.src=parent.VideoRodet.document.foto"+ i_capa_video +".src");
	
	//Actualitzo la posició de la barra d'scroll
    var i_actual=0;
	var el_tinc=false;
	for (var i_capa=0; i_capa<DatesVideo.length; i_capa++)
	{	
		if (DatesVideo[i_capa].animable)
		{
			if (i_capa==i_capa_video)
			{
				el_tinc=true;
				eval("parent.VideoRodet.document.marc_sup"+i_capa+".src=\"1vermell.gif\"");
				eval("parent.VideoRodet.document.marc_dre"+i_capa+".src=\"1vermell.gif\"");
				eval("parent.VideoRodet.document.marc_esq"+i_capa+".src=\"1vermell.gif\"");
				eval("parent.VideoRodet.document.marc_inf"+i_capa+".src=\"1vermell.gif\"");
			}
			else
			{			    			    
				if (!el_tinc)
					i_actual++;
				eval("parent.VideoRodet.document.marc_sup"+i_capa+".src=\"1negre.gif\"");
				eval("parent.VideoRodet.document.marc_dre"+i_capa+".src=\"1negre.gif\"");
				eval("parent.VideoRodet.document.marc_esq"+i_capa+".src=\"1negre.gif\"");
				eval("parent.VideoRodet.document.marc_inf"+i_capa+".src=\"1negre.gif\"");
			}
		}
	}

	
    if (actualitza_scroll && parent.VideoRodet.document.body && parent.VideoRodet.document.body.scrollHeight)
    {
		if (i_actual>0)
		    i_actual--;
		parent.VideoRodet.scrollTo(0, i_actual*parent.VideoRodet.document.body.scrollHeight/DatesVideo.length);
	}
}

function DeterminaICapaVideoSeguent(i_capa_mostrada, opcio)
{
var i_capa_a_mostrar=i_capa_mostrada;
var i_capa_video_actiu;

	with (parent.opener)
    {
		if (i_capa_mostrada==-1)
		{
			for(var i=0; i<DatesVideo.length; i++)
			{
				if(DatesVideo[i].animable)
					return i_capa_a_mostrar=i;
			}
		}
		else
		{
			for (i_capa_video_actiu=0; i_capa_video_actiu<DatesVideo.length; i_capa_video_actiu++)
			{	
				if (i_capa_video_actiu!=i_capa_mostrada && 
					DatesVideo[i_capa_video_actiu].animable)
				{			 	    				
					if (opcio==1)
					{
						if (DatesVideo[i_capa_mostrada].milisegons < DatesVideo[i_capa_video_actiu].milisegons)
						{
							if (i_capa_a_mostrar==i_capa_mostrada)
								i_capa_a_mostrar=i_capa_video_actiu;
							else if (DatesVideo[i_capa_a_mostrar].milisegons >	DatesVideo[i_capa_video_actiu].milisegons)
								i_capa_a_mostrar=i_capa_video_actiu; 
						}
					}
					else
					{
						if (DatesVideo[i_capa_mostrada].milisegons > DatesVideo[i_capa_video_actiu].milisegons)
						{
							if (i_capa_a_mostrar==i_capa_mostrada)
								i_capa_a_mostrar=i_capa_video_actiu;
							else if (DatesVideo[i_capa_a_mostrar].milisegons < DatesVideo[i_capa_video_actiu].milisegons)
								i_capa_a_mostrar=i_capa_video_actiu; 
						}
					}
				}
			}
		}
	}
	return i_capa_a_mostrar;
}

var timeoutID=null;
function VideoPlay(opcio)
{
	if (timeoutID!=null)
	{
	    clearTimeout(timeoutID);
	    timeoutID=null;
	}
	VideoPlayRecursiva(opcio);
	return false;
}

function VideoPlayRecursiva(opcio)
{
var i_capa_a_mostrar;
var i_capa_previa;
var n;


	if (parent.VideoBarra.document.botons.TipusTemps[0].checked)
	{
	   n=parseFloat(parent.VideoBarra.document.botons.EscalaTemporal.value);
	   if (n<=0)
	       alert(parent.opener.DonaCadenaLang({"cat":"Valor incorrecte de l'escala temporal.", 
		   										"spa":"Valor incorrecto de la escala temporal.", 
												"eng":"Wrong value in temporal scale.", 
												"fre":"Valeur incorrect de l'échelle temporelle"}));
	   else
	   {
		   if (0==VideoMostra(opcio)) 	   //mostrar la imatge que toca.
		   {
         	   //buscar la imatge següent.
		       i_capa_a_mostrar=DeterminaICapaVideoSeguent(ICapaVideoMostrada, 1)
			   if (ICapaVideoMostrada==i_capa_a_mostrar)
			   {
				   	if (opcio==9)
						return; //Estic al final d'una sequencia automàtica.

					//animació circular
					i_capa_a_mostrar=0;
					while (DatesVideo[i_capa_a_mostrar].animable==false)
					{
						i_capa_previa=i_capa_a_mostrar;
						i_capa_a_mostrar=DeterminaICapaVideoSeguent(i_capa_previa, 1);
						if (i_capa_previa==i_capa_a_mostrar)
						return;  //alguna cosa no va
					}
			   }
			   timeoutID=setTimeout('VideoPlayRecursiva('+opcio+')', (DatesVideo[i_capa_a_mostrar].milisegons-DatesVideo[ICapaVideoMostrada].milisegons)/n);
		   }		   		   		   
 	   }
	}
	else if (parent.VideoBarra.document.botons.TipusTemps[1].checked)
	{
	   n=parseFloat(parent.VideoBarra.document.botons.interval.value);
	   if (n<=0)
	       alert("Valor incorrecte de l'interval de segons.");
	   else
	   {	
			if (0==VideoMostra(opcio))
			{
				timeoutID=setTimeout("VideoPlayRecursiva("+opcio+")", n*1000);
			}
	   }
	}
	else
		alert(parent.opener.DonaCadenaLang({"cat":"Sel·lecciona escala temporal o interval",
											"spa": "Seleccione escala temporal o intervalo",
											"eng":"Select temporal scale or interval",
											"fre": "Sélectionner échelle temporelle où intervalle"}));	   	
}//Fi de VideoPlayRecursiva()

function VideoMostraRetornFalse(opcio)
{
	VideoMostra(opcio);
	return false;
}

function VideoMostra(opcio)
{
var i_capa_a_mostrar=ICapaVideoMostrada;
var i_capa_previa;

  
   if (opcio!=8 && opcio!=9)
   {
   		if (timeoutID!=null)
		{
            clearTimeout(timeoutID);
	    	timeoutID=null;
		}
    }
    if (opcio==1 || opcio==8 || opcio==9)
    {
	    i_capa_a_mostrar=DeterminaICapaVideoSeguent(ICapaVideoMostrada, 1);
		if ((opcio==8 || opcio==9) && ICapaVideoMostrada==i_capa_a_mostrar)
		{
		    //Estic al final d'una sequencia automàtica.
			if (opcio==9)
				return 1;

			//animació circular
		 	i_capa_a_mostrar=0;
			while (DatesVideo[i_capa_a_mostrar].animable==false)
			{
				i_capa_previa=i_capa_a_mostrar;
				i_capa_a_mostrar=DeterminaICapaVideoSeguent(i_capa_previa, 1);
				if (i_capa_previa==i_capa_a_mostrar)
				return;  //alguna cosa no va
			}			
 		}
	}
    else if (opcio==-1)
    {
		i_capa_a_mostrar=DeterminaICapaVideoSeguent(ICapaVideoMostrada, -1);
	}
    else if (opcio==2)
	{
		i_capa_a_mostrar=DatesVideo.length-1;    
		while (DatesVideo[i_capa_a_mostrar].animable==false)
		{
			i_capa_previa=i_capa_a_mostrar;
			i_capa_a_mostrar=DeterminaICapaVideoSeguent(i_capa_previa, -1);
			if (i_capa_previa==i_capa_a_mostrar)
			return;  //alguna cosa no va
		}
	}
    else if (opcio==-2)
	{
		i_capa_a_mostrar=0;
		while (DatesVideo[i_capa_a_mostrar].animable==false)
		{
			i_capa_previa=i_capa_a_mostrar;
			i_capa_a_mostrar=DeterminaICapaVideoSeguent(i_capa_previa, 1);
			if (i_capa_previa==i_capa_a_mostrar)
			return;  //alguna cosa no va
		}
	}
	
	/*else  //(opcio==0)*/
	MostraFotograma(i_capa_a_mostrar, true);
	return 0;
}
// -->
</script>
</head>


<script>
with (parent.opener)
{
    this.document.writeln("<BODY BGCOLOR=\"" + ParamCtrl.ColorFonsPlana + "\" TOPMARGIN=\"0\" LEFTMARGIN=\"0\" MARGINWIDTH=\"0\" MARGINHEIGHT=\"0\" TEXT=\"#000000\">");
    this.document.write("&nbsp;"+DonaCadena(ParamCtrl.TitolCaixa));
	this.document.writeln("</body>");
}
</script>
</html>

